<!DOCTYPE html>
<html lang="ko">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>DTF</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <!-- Page level plugin CSS-->
    <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin.css" rel="stylesheet">


</head>

<body id="page-top">

<nav class="navbar navbar-expand navbar-dark bg-dark static-top">

    <a class="navbar-brand mr-1" href="index.html">DTF</a>

    <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
        <i class="fas fa-bars"></i>
    </button>


</nav>

<div id="wrapper">
    <div class="container">
        <div class="row my-4">
            <div class="col">
                    <h2>Image Uploader</h2>
                    <p>폴더 업로드</p>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="customFile" webkitdirectory directory multiple>
                        <label class="custom-file-label" for="customFile">Choose file</label>
                    </div>
                    <form action="/file-upload" class="dropzone dz-clickable" id="my-dropzone">
                        <div class="dz-message d-flex flex-column">
                            <b class="m-5">Drag & Drop Files Here</b>
                        </div>
                    </form>
                </div>
        </div>
    </div>

    <!--
    <ul class="sidebar navbar-nav">
        <li class="nav-item active">
            <a class="nav-link" href="index.html">
                <i class="fas fa-fw fa-table"></i>
                <span>Exam</span>
            </a>
        </li>

    </ul>Sidebar -->



<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


<!-- Bootstrap core JavaScript-->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Dropzone.js-->
<script src="js/dropzone.js"></script>

<!-- Core plugin JavaScript-->
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Page level plugin JavaScript-->
<script src="vendor/chart.js/Chart.min.js"></script>
<script src="vendor/datatables/jquery.dataTables.js"></script>
<script src="vendor/datatables/dataTables.bootstrap4.js"></script>

<!-- Custom scripts for all pages-->
<script src="js/sb-admin.min.js"></script>
<!-- Bootstrap Date-Picker Plugin -->
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>

<script>
    //Global variables
    let projectname = "AIM201901";
    var table;
    var subTable;
    var dataTab;
    let nondataTab;
    let newlesiondataTab;
    let newlesionTable;
    let nontagretTable;
    var subDataTab;
    var selectedId;
    var selectedSubId;
    var rows_selected = [];
    let tagetlist = new Array("select", "Uterus", "Lymphnode ", "Lung", "Liver");
    let methodlist = new Array("select","CT", "MR", "PET/CT", "Bone Scan", "test3", "tset6", "Other");
    let reistlist = new Array("select", "CR", "PR", "SD", "PD", "NE");
    let ireistlist = new Array("select", "iCR", "iPR", "iSD", "iUPD","iCPD", "NE");
    let lesionstatuslist = new Array("select", "Present at Baseline", "Absent on F/U", "Present on F/U", "Increased on F/U","NE on F/U");
    let sumofmeasure = 0.0;
    let sum_bl = 0.0;
    let sum_nedir = 0.0;
    let percent_bl = 0.0;
    let percent_neidr = 0.0;
    let date_of_nedir = "";

    let newlesionvalue = {
        "id": "",
        "organ": "",
        "site": "",
        "series": "",
        "image": "",
        "method": "",
        "method_other": "",
        "lesion_type": "",
        "assessment": "",
        "previously_reported": ""
    };


    let targetvalue = {
        "id": "",
        "organ": "",
        "site": "",
        "series": "",
        "image": "",
        "method": "",
        "method_other": "",
        "measurement": ""
    };
    let nontargetvalue = {
        "id": "",
        "organ": "",
        "site": "",
        "series": "",
        "image": "",
        "method": "",
        "method_other": "",
        "non_lesion_status": ""
    };
    let targetData = [{
        "id": 1,
        "organ": "Lung",
        "site": "LUL",
        "series": "3",
        "image": "55",
        "method": "55",
        "method_other": "",
        "measurement": "55.54"
    }];
    let nontargetData = [{
        "id": 1,
        "organ": "Lung",
        "site": "RUL",
        "series": "4",
        "image": "55",
        "method": "55",
        "method_other": "",
        "non_lesion_status": "Present at Baseline"
    }];


    let newlesionData = [{
        "id": 1,
        "organ": "Lung",
        "site": "LUL",
        "series": "3",
        "image": "55",
        "method": "55",
        "method_other": "",
        "lesion_type": "55.54",
        "assessment": "",
        "previously_reported": ""
    }];



    $(document).ready(function () {

        $("#project_name").append("  " + projectname);
        $("#subject_name").append("S01001");
        $("#scan_date").append("2019-09-26");
        $("#time_point").append("BL");
        $("#visit").append("Screening");
        $("#week").append("4");
        $("#confirmatory_scan").append("4");


        createTargetTable();
        createNonTargetTable();
        createNewLesionTable();

        $(function () {
            for (let i = 0; i < reistlist.length; i++) {
                if (reistlist[i] === "select") {
                    $('#response_of_target_lesion_recist').append('"<option selected="selected" value="' + reistlist[i] + '">' + reistlist[i] + '</option>');
                    $('#response_of_nontarget_lesion_recist').append('"<option selected="selected" value="' + reistlist[i] + '">' + reistlist[i] + '</option>');
                    $('#response_of_overall_recist').append('"<option selected="selected" value="' + reistlist[i] + '">' + reistlist[i] + '</option>');
                }
                else {
                    $('#response_of_target_lesion_recist').append('"<option value="' + reistlist[i] + '">' + reistlist[i] + '</option>');
                    $('#response_of_nontarget_lesion_recist').append('"<option value="' + reistlist[i] + '">' + reistlist[i] + '</option>');
                    $('#response_of_overall_recist').append('"<option value="' + reistlist[i] + '">' + reistlist[i] + '</option>');
                }
            }
            for (let i = 0; i < ireistlist.length; i++) {
                if (ireistlist[i] === "select") {
                    $('#response_of_target_lesion_irecist').append('"<option selected="selected" value="' + ireistlist[i] + '">' + ireistlist[i] + '</option>');
                    $('#response_of_nontarget_lesion_irecist').append('"<option selected="selected" value="' + ireistlist[i] + '">' + ireistlist[i] + '</option>');
                    $('#response_of_overall_irecist').append('"<option selected="selected" value="' + ireistlist[i] + '">' + ireistlist[i] + '</option>');
                } else {
                    $('#response_of_target_lesion_irecist').append('"<option value="' + ireistlist[i] + '">' + ireistlist[i] + '</option>');
                    $('#response_of_nontarget_lesion_irecist').append('"<option value="' + ireistlist[i] + '">' + ireistlist[i] + '</option>');
                    $('#response_of_overall_irecist').append('"<option value="' + ireistlist[i] + '">' + ireistlist[i] + '</option>');
                }
            }
            updateSumOfMeasure();
        });


        /* $('#btnSubmit').click(function () {
             insertData();
             return false;
         });


         $('#dataTable tbody').on('click', 'tr', function () {
             //console.log($(this).attr("id"));
             selectedId = $(this).attr("id");

             chargeSubData();

         });*/
    });

    function updateSumOfMeasure() {
        //  $('#sum_of_measurement').attr('value',sumofmeasure);

        let sum = 0.0;
        for(let i=0; i<targetData.length;i++)
        {
            sum+=   Number(targetData[i]['measurement']);
        }
        sumofmeasure = sum;

        $("#sum_of_measurement").empty();
        $("#sum_of_measurement").append("  " + sumofmeasure.toFixed(2));
    }

    function addTargetTableData()
    {
        //    function AjaxRefreshSubDataSucceeded(result) {

        // if (result.d != "[]") {

        dataTab = targetData;
        //when the instance of datatable exists, only pass the data :D
        table.fnClearTable();
        table.fnAddData(dataTab);
        updateSumOfMeasure();
        //   }
        // }
    }

    function addNewLesionTableData()
    {
        //    function AjaxRefreshSubDataSucceeded(result) {

        // if (result.d != "[]") {

        newlesiondataTab = newlesionData;
        //when the instance of datatable exists, only pass the data :D
        newlesionTable.fnClearTable();
        newlesionTable.fnAddData(newlesiondataTab);
        // updateSumOfMeasure();
        //   }
        // }
    }
    function addNonTargetTableData()
    {
        //    function AjaxRefreshSubDataSucceeded(result) {

        // if (result.d != "[]") {

        nondataTab = nontargetData;
        //when the instance of datatable exists, only pass the data :D
        nontagretTable.fnClearTable();
        nontagretTable.fnAddData(nondataTab);

        //   }
        // }
    }
    // Handle click on "Select all" control
    $('thead input[name="select_all"]').on('click', function (e) {
        if (this.checked) {
            $('#dataTableSub tbody input[type="checkbox"]:not(:checked)').trigger('click');
        } else {
            $('#dataTableSub tbody input[type="checkbox"]:checked').trigger('click');
        }

        // Prevent click event from propagating to parent
        e.stopPropagation();
    });

    // Handle click on checkbox
    $('#dataTableSub tbody').on('click', 'input[type="checkbox"]', function (e) {
        var $row = $(this).closest('tr');

        // Get row ID
        selectedSubId = $($row).attr("id");

        // Determine whether row ID is in the list of selected row IDs
        var index = $.inArray(selectedSubId, rows_selected);

        // If checkbox is checked and row ID is not in list of selected row IDs
        if (this.checked && index === -1) {
            rows_selected.push(selectedSubId);

            // Otherwise, if checkbox is not checked and row ID is in list of selected row IDs
        } else if (!this.checked && index !== -1) {
            rows_selected.splice(index, 1);
        }

        if (this.checked) {
            $row.addClass('selected');
        } else {
            $row.removeClass('selected');
        }

        // Prevent click event from propagating to parent
        e.stopPropagation();
    });

    $('#frmSub').on('submit', function (e) {
        var form = this;

        // Iterate over all selected checkboxes
        $.each(rows_selected, function (index, rowId) {
            // Create a hidden element
            $(form).append(
                $('<input>')
                    .attr('type', 'hidden')
                    .attr('name', 'id[]')
                    .val(rowId)
            );
        });

        // FOR DEMONSTRATION ONLY

        // Output form data to a console
        $('#example-console').text($(form).serialize());
        console.log("Form submission", $(form).serialize());

        // Remove added elements
        $('input[name="id\[\]"]', form).remove();

        // Prevent actual form submission
        e.preventDefault();
    });

    // 1. charge all data
    function chargeSubData() {
        $.ajax({
            type: "GET",
            //create a method for search the data and show in datatable
            url: "http://13.124.164.177:8080/api/test",
            contentType: "application/json; charset=utf-8",
            data: '',
            dataType: "json",
            success: AjaxGetSubDataSucceeded,
            error: AjaxGetFieldDataFailed
        });
    }

    function AjaxGetSubDataSucceeded(result) {
        if (result != "[]") {

            subDataTab = result;
            //instance of datatable
            subTable = $('#dataTableSub').dataTable({
                "bProcessing": true,
                "aaData": subDataTab,
                //important  -- headers of the json
                "aoColumns": [{
                    'targets': 0,
                    'searchable': false,
                    'orderable': false,
                    'width': '1%',
                    'className': 'dt-body-center',
                    'render': function (data, type, full, meta) {
                        return '<input type="checkbox">';
                    }
                },
                    {
                        data: "patientName"
                    },
                    {
                        data: "patientID"
                    },
                    {
                        data: "examName"
                    },
                    {
                        data: "patientAge"
                    },
                    {
                        data: "patientSex"
                    },
                    {
                        data: "physician"
                    },
                    {
                        data: "readingStatus"
                    },
                    {
                        data: "readingDate"
                    },
                    {
                        data: "modality"
                    },
                    {
                        data: "resistUID",
                        "render": function (data) {
                            if (data != null) {
                                data = '<a href="page?uid=' + data + '" target="_blank" class="btn btn-info">' + 'R' + '</a>';
                            }
                            return data;


                        }
                    },
                    {
                        data: "imageUID",
                        "render": function (data) {
                            if (data != null) {
                                data = '<a href="page1?uid=' + data + '" target="_blank" class="btn btn-warning">' + 'I' + '</a>';
                            }
                            return data;


                        }
                    }
                ],
                "sPaginationType": "full_numbers",
                "aaSorting": [
                    [1, "asc"]
                ],
                "bJQueryUI": true,
                rowId: 'patientID'
            });

            $("#subTableDiv").show();

        }
    }

    function AjaxGetFieldDataFailed(result) {
        alert(result.status + ' ' + result.statusText);
    }


    // 1. charge all data
    function chargeData() {
        $.ajax({
            type: "GET",
            //create a method for search the data and show in datatable
            url: "http://13.124.164.177:8080/api/test",
            contentType: "application/json; charset=utf-8",
            data: '',
            dataType: "json",
            success: AjaxGetFieldDataSucceeded,
            error: AjaxGetFieldDataFailed
        });
    }

    function makeinput(name, full, value,  alert) {
        let itemid ;
        let id = full.id;

        if (value != null) {
            itemid = name + "_" + id;

        } else
            itemid = name + "_" + id;


        let ouput ='';
        if(name!=="method_other" && name!=="non_method_other") {
            if (full.organ === "") {
                ouput = '<input type="text" id="' + itemid + '" ' +
                    'name="' + itemid + '" class="form-control smaller" placeholder="input"  value="' + value + '" disabled >';
            } else {
                ouput = '<input type="text" id="' + itemid + '" ' +
                    'name="' + itemid + '" class="form-control smaller" placeholder="input"  value="' + value + '"  >';
            }
        }else {
            if (full.method !== "Other" ) {
                ouput = '<input type="text" id="' + itemid + '" ' +
                    'name="' + itemid + '" class="form-control smaller" placeholder="input"  value="' + value + '" disabled >';
            } else {
                ouput = '<input type="text" id="' + itemid + '" ' +
                    'name="' + itemid + '" class="form-control smaller" placeholder="input"  value="' + value + '"  >';
            }
        }



        if (name !== 'measurement') {

            ouput += '<small id="' + itemid + '_alter" class="text-danger" style="display:none">please input value</smail>';


        } else {
            ouput += '<small id="' + itemid + '_alter" class="text-danger" style="display:none">please input value bigger than 5mm</smail>';
        }

        $(function () {
            $('#' + itemid).blur(function () {
                let val = $(this).val();
                if(alert)
                {
                    if (val < 5.00) {
                        $(this).attr('class', 'form-control smaller is-invalid');
                        $('#' + itemid + '_alter').show();

                    } else {
                        $(this).attr('class', 'form-control smaller is-valid');
                        $('#' + itemid + '_alter').hide();
                    }
                }
                if(name.includes("non"))
                {
                    nontargetData[id - 1][name.substr(4,name.length)]     = val;

                }
                if(name.includes("new"))
                {
                    newlesionData[id - 1][name.substr(4,name.length)]     = val;

                }
                else {
                    targetData[id - 1][name] = val;
                    updateSumOfMeasure();
                }


            });
        });




        return ouput;
    }

    function makeselect(name, full, value, selectList,disable) {
        let ouput = "";

        let id = full.id;

        let selectID = name + "_" + id;



        if( disable &&  full.organ ==="") {
            ouput = '<select id="' + selectID + '" class="custom-select smaller"  disabled="true"  >';

        }else {
            ouput = '<select id="' + selectID + '" class="custom-select smaller"   >';
        }
        for (let i = 0; i < selectList.length; i++) {
            if (selectList[i] === value)
                ouput += '"<option   selected="selected" value="' + selectList[i] + '">' + selectList[i] + '</option>';
            else
                ouput += '"<option value="' + selectList[i] + '">' + selectList[i] + '</option>';
        }
        ouput += '</select>';

        return ouput;

    }

    function createNonTargetTable() {
        // if (result != "[]")
        {


            nondataTab = nontargetData;
            //instance of datatable
            nontagretTable = $('#nontargetTable').dataTable({
                "bProcessing": true,
                "aaData": nondataTab,
                //important  -- headers of the json
                "aoColumns": [
                    {
                        data: "id"
                    },
                    {
                        data: "organ", "render": function (data, type, full, meta) {

                            let output = makeselect("non_target_organ", full, data, tagetlist, false);
                            let selectID = "non_target_organ_"+full.id;
                            let id = full.id;

                            $(function () {
                                $('#' + selectID).change(function () {

                                    let val = $('#' + selectID + ' option:selected').val();
                                    nontargetData[full.id-1]["organ"] = val;

                                    if (val !== 'select') {
                                        $('#non_site_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#non_series_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#non_image_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#non_method_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#non_lesion_status' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        if((nontargetData.length)===id  && (nontargetData.length)<5)  {
                                            nontargetvalue.id = nontargetData.length + 1;
                                            nontargetData.push(JSON.parse(JSON.stringify(nontargetvalue)));
                                            addNonTargetTableData();
                                        }
                                    }else {
                                        $('#non_site_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#non_series_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#non_image_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#non_method_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#non_lesion_status_' + id).attr("readonly", false).prop("disabled", true); //입력불가

                                    }
                                });
                            });
                            return output;
                        }
                    },
                    {
                        data: "site", "render": function (data, type, full, meta) {

                            return makeinput("non_site", full, data, true);
                        }
                    },
                    {
                        data: "series", "render": function (data, type, full, meta) {
                            return makeinput("non_series", full, data, false);
                        }
                    },
                    {
                        data: "image", "render": function (data, type, full, meta) {
                            return makeinput("non_image", full, data, false);
                        }
                    },
                    {
                        data: "method", "render": function (data, type, full, meta) {
                            //  return makeselect("non_method", full, data, methodlist,true);
                            let output = makeselect("non_method", full, data, methodlist, true);
                            let selectID = "non_method_"+full.id;
                            let id = full.id;
                            $(function () {
                                $('#' + selectID).change(function () {

                                    let val = $('#' + selectID + ' option:selected').val();
                                    nontargetData[full.id-1]["method"] = val;

                                    if (val !== 'Other') {
                                        $('#non_method_other_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                    }else {
                                        $('#non_method_other_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                    }
                                });
                            });
                            return output;

                        }
                    },
                    {
                        data: "method_other", "render": function (data, type, full, meta) {
                            return makeinput("non_method_other", full, data, true);
                        }
                    },
                    {
                        data: "non_lesion_status", "render": function (data, type, full, meta) {
                            return makeselect("non_lesion_status", full, data, lesionstatuslist,true);
                        }
                    }
                ],
                "sPaginationType": "full_numbers",
                "aaSorting": [
                    [0, "asc"]
                ],
                "bJQueryUI": true,
                "soring": false,
                "ordering": false,

                "searching": false,

                "bPaginate": false,
                "bLengthChange": false,
                "bFilter": true,
                "bInfo": false,
                "bAutoWidth": false

            });
        }
    }


    function  createTargetTable() {
        // if (result != "[]")
        {

            dataTab = targetData;
            //instance of datatable
            table = $('#targetTable').dataTable({
                "bProcessing": true,
                "aaData": dataTab,


                //important  -- headers of the json
                "aoColumns": [
                    {
                        data: "id"
                    },
                    {
                        data: "organ", "render": function (data, type, full, meta) {

                            let output =  makeselect("target_organ", full, data, tagetlist, false);
                            let selectID = "target_organ_"+full.id;
                            let id = full.id;
                            $(function () {
                                $('#' + selectID).change(function () {

                                    let val = $('#' + selectID + ' option:selected').val();
                                    targetData[full.id-1]["organ"] = val;

                                    if (val !== 'select') {
                                        $('#site_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#series_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#image_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#method_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        //  $('#method_other' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#measurement_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        if((targetData.length)===id  && (targetData.length)<5)  {
                                            targetvalue.id = targetData.length + 1;
                                            targetData.push(JSON.parse(JSON.stringify(targetvalue)));
                                            addTargetTableData();
                                        }
                                    }else {
                                        $('#site_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#series_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#image_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#method_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#measurement_' + id).attr("readonly", false).attr("disabled", true); //입력불가

                                    }
                                });
                            });

                            return output;
                        }
                    },
                    {
                        data: "site", "render": function (data, type, full, meta) {
                            return makeinput("site", full, data, true);
                        }
                    },
                    {
                        data: "series", "render": function (data, type, full, meta) {
                            return makeinput("series", full, data, true);
                        }
                    },
                    {
                        data: "image", "render": function (data, type, full, meta) {
                            return makeinput("image", full, data, true);
                        }
                    },
                    {
                        data: "method", "render": function (data, type, full, meta) {
                            let output = makeselect("method", full, data, methodlist, true);
                            let selectID = "method_"+full.id;
                            let id = full.id;
                            $(function () {
                                $('#' + selectID).change(function () {

                                    let val = $('#' + selectID + ' option:selected').val();
                                    targetData[full.id-1]["method"] = val;

                                    if (val !== 'Other') {
                                        $('#method_other_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                    }else {
                                        $('#method_other_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                    }
                                });
                            });
                            return output;

                        }
                    },
                    {
                        data: "method_other", "render": function (data, type, full, meta) {
                            return makeinput("method_other", full, data, true);
                        }
                    },

                    {
                        data: "measurement", "render": function (data, type, full, meta) {
                            return makeinput("measurement", full, data, true);
                        }
                    }

                ],
                "sPaginationType": "full_numbers",
                "aaSorting": [
                    [0, "asc"]
                ],
                "bJQueryUI": true,
                "soring": false,
                "ordering": false,

                "searching": false,

                "bPaginate": false,
                "bLengthChange": false,
                "bFilter": true,
                "bInfo": false,
                "bAutoWidth": false

            });
        }
    }

    function  createNewLesionTable() {
        // if (result != "[]")
        {

            newlesiondataTab = newlesionData;
            //instance of datatable
            newlesionTable = $('#newlesionTable').dataTable({
                "bProcessing": true,
                "aaData": newlesiondataTab,


                //important  -- headers of the json
                "aoColumns": [
                    {
                        data: "id"
                    },
                    {
                        data: "organ", "render": function (data, type, full, meta) {

                            let output =  makeselect("newlesion_organ", full, data, tagetlist, false);
                            let selectID = "newlesion_organ_"+full.id;
                            let id = full.id;
                            $(function () {
                                $('#' + selectID).change(function () {

                                    let val = $('#' + selectID + ' option:selected').val();

                                    newlesionData[full.id-1]["organ"] = val;

                                    if (val !== 'select') {
                                        $('#newlesion_site_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#newlesion_series_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#newlesion_image_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#newlesion_method_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        //  $('#method_other' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        $('#lesion_type_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                        if((newlesionData.length)===id  && (newlesionData.length)<5)  {


                                            newlesionvalue.id = newlesionData.length + 1;
                                            newlesionData.push(JSON.parse(JSON.stringify(newlesionvalue)));
                                            addNewLesionTableData();
                                        }
                                    }else {

                                        $('#newlesion_site_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#newlesion_series_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#newlesion_image_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#newlesion_method_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                        $('#lesion_type_' + id).attr("readonly", false).attr("disabled", true); //입력불가

                                    }
                                });
                            });

                            return output;
                        }
                    },
                    {
                        data: "site", "render": function (data, type, full, meta) {
                            return makeinput("newlesion_site", full, data, true);
                        }
                    },
                    {
                        data: "series", "render": function (data, type, full, meta) {
                            return makeinput("newlesion_series", full, data, true);
                        }
                    },
                    {
                        data: "image", "render": function (data, type, full, meta) {
                            return makeinput("newlesion_image", full, data, true);
                        }
                    },
                    {
                        data: "method", "render": function (data, type, full, meta) {
                            let output = makeselect("newlesion_method", full, data, methodlist, true);
                            let selectID = "newlesion_method_"+full.id;
                            let id = full.id;
                            $(function () {
                                $('#' + selectID).change(function () {

                                    let val = $('#' + selectID + ' option:selected').val();
                                    targetData[full.id-1]["method"] = val;

                                    if (val !== 'Other') {
                                        $('#newlesion_method_other_' + id).attr("readonly", false).attr("disabled", true); //입력불가
                                    }else {
                                        $('#newlesion_method_other_' + id).attr("readonly", false).attr("disabled", false); //입력불가
                                    }
                                });
                            });
                            return output;

                        }
                    },
                    {
                        data: "method_other", "render": function (data, type, full, meta) {
                            return makeinput("newlesion_method_other", full, data, true);
                        }
                    },

                    {
                        data: "lesion_type", "render": function (data, type, full, meta) {

                            let id = full.id;
                            let itemid = "lesion_type_" + id;

                            let output =  '<div class="custom-control custom-radio custom-control-inline smaller"> '+
                                ' <input type="radio" class="custom-control-input" id="'+itemid+'" name="'+itemid+'" value="Target">' +
                                '<label class="custom-control-label" for="'+itemid+'">Target</label></div>';
                            output +=  '<div class="custom-control custom-radio custom-control-inline smaller"> '+
                                ' <input type="radio" class="custom-control-input" id="'+itemid+'_non" name="'+itemid+'" value="Non_target">' +
                                '<label class="custom-control-label" for="'+itemid+'_non">Non-Target</label></div>';

                            $(function () {
                                $('input[name='+itemid+']').change(function () {
                                    var value = $( 'input[name='+itemid+']:checked' ).val();

                                    if(value!=='Non_target')
                                    {
                                        $('#assessment_'+id).replaceWith(makeinput("assessment", full, data, true));
                                    }else
                                    {
                                        $('#assessment_'+id).replaceWith(makeselect("assessment", full, data, lesionstatuslist,true));
                                    }

                                });
                            });



                            return output;// makeinput("lesion_type", full, data, true);
                        }
                    },
                    {
                        data: "assessment", "render": function (data, type, full, meta) {
                            return makeinput("assessment", full, data, true);
                        }
                    },
                    {
                        data: "previously_reported", "render": function (data, type, full, meta) {
                            let id = full.id;
                            let itemid = "previously_reported" + id;

                            let output =  '<div class="custom-control custom-radio custom-control-inline smaller"> '+
                                ' <input type="radio" class="custom-control-input" id="'+itemid+'" name="'+itemid+'" value="Yes">' +
                                '<label class="custom-control-label" for="'+itemid+'">Yes</label></div>';
                            output +=  '<div class="custom-control custom-radio custom-control-inline smaller"> '+
                                ' <input type="radio" class="custom-control-input" id="'+itemid+'_No" name="'+itemid+'" value="No">' +
                                '<label class="custom-control-label" for="'+itemid+'_No">No</label></div>';

                            $(function () {
                                $('input[name='+itemid+']').change(function () {
                                    var value = $( 'input[name='+itemid+']:checked' ).val();

                                    alert(value);
                                    newlesionData[full.id-1]["previously_reported"] = value;

                                });
                            });

                            return output;
                        }
                    }

                ],
                "sPaginationType": "full_numbers",
                "aaSorting": [
                    [0, "asc"]
                ],
                "bJQueryUI": true,
                "soring": false,
                "ordering": false,

                "searching": false,

                "bPaginate": false,
                "bLengthChange": false,
                "bFilter": true,
                "bInfo": false,
                "bAutoWidth": false

            });
        }
    }



    function AjaxGetFieldDataSucceeded(result) {
        if (result != "[]") {

            dataTab = result;
            //instance of datatable
            table = $('#dataTable').dataTable({
                "bProcessing": true,
                "aaData": dataTab,
                //important  -- headers of the json
                "aoColumns": [{
                    data: "patientName", "render": function (data) {
                        if (data != null) {
                            data = ' <select id="" name="city"> </select>';

                        }
                        return data;
                    }
                },
                    {
                        data: "patientID"
                    },
                    {
                        data: "examName"
                    },
                    {
                        data: "patientAge"
                    },
                    {
                        data: "patientSex"
                    },
                    {
                        data: "physician"
                    },
                    {
                        data: "readingStatus"
                    },
                    {
                        data: "readingDate"
                    },
                    {
                        data: "modality"
                    }
                ],
                "sPaginationType": "full_numbers",
                "aaSorting": [
                    [0, "asc"]
                ],
                "bJQueryUI": true,
                rowId: 'patientID'

            });

        }

        $.each(testarr, function (i) {
            $(".city").append("<option value='" + testarr[i] + "'>" + testarr[i] + "</option>")
        });


    }

    // 2. this function only insert the data in your database
    function insertData() {

        $.ajax({
            type: "POST",
            //in this method insert the data in your database
            url: "http://13.124.164.177:8080/api/events",
            data: $("#frm").serialize(),
            dataType: "json",
            success: AjaxRefreshDataSucceeded,
            error: AjaxGetFieldDataFailed
        });
    }

    function AjaxRefreshDataSucceeded(result) {

        if (result.d != "[]") {
            var jposts = result;
            dataTab = jposts;
            //when the instance of datatable exists, only pass the data :D
            table.fnClearTable();
            table.fnAddData(dataTab);
        }
    }


    function AjaxGetFieldDataFailed(result) {
        alert(result.status + ' ' + result.statusText);
    }


    var datepicker = $('.datepicker'); //our date input has the name "date"

    var options = {
        format: 'yyyy-mm-dd',
        todayHighlight: true,
        autoclose: true,
    };
    datepicker.datepicker(options);
</script>
</div>
</body>

</html>
